<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
    <script src="../script.js"></script>
    <script src="../js/funcoes.js"></script>
    <link rel="shortcut icon" href="../assets/favicon/faviconEI.ico" type="image/x-icon">

    <title>Elas Inspiram | Mural</title>
</head>

<body id="bodyMural" onload="validarSessao(), atualizarFeed()">
    <div class="wrapperPopUp" id="pop-up">
        <div class="login-box">
            <div class="fechar">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                    class="bi bi-door-open" viewBox="0 0 16 16">
                    <path d="M8.5 10c-.276 0-.5-.448-.5-1s.224-1 .5-1 .5.448.5 1-.224 1-.5 1z" />
                    <path
                        d="M10.828.122A.5.5 0 0 1 11 .5V1h.5A1.5 1.5 0 0 1 13 2.5V15h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V1.5a.5.5 0 0 1 .43-.495l7-1a.5.5 0 0 1 .398.117zM11.5 2H11v13h1V2.5a.5.5 0 0 0-.5-.5zM4 1.934V15h6V1.077l-6 .857z" />
                </svg>
                <span onclick="fecharPopUpDoacao() ">Sair</span>
            </div>
            <div class="nomeCausa">
                <label id="tituloPopUp"></label>
            </div>
            <form>
                <div class="user-box">
                    <input type="number" name="" required="">
                    <label>Valor</label>
                </div>
                <center>
                    <a href="#">
                        Doar
                        <span></span>
                    </a>
                </center>
            </form>
        </div>
    </div>

    <div class="containerMenu" id="containerMenu">
        <div class="menuMural">
            <div class="muralLogo">
                <a href="index.html">
                    <svg width="80" height="50" viewBox="0 0 75 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M29.2397 16.1866V21.1915H15.0552V29.1505H25.0893V34.1554H15.0552V46.2892H29.7524V51.2941H8.24364V16.1866H29.2397Z"
                            fill="#CFA7A5" />
                        <path d="M44.7225 17.5H36.66L26.396 40H34.9731V55H46.4093V40H54.9864L44.7225 17.5Z"
                            fill="#CFA7A5" />
                        <path
                            d="M40.6912 15C43.8492 15 46.4093 12.7614 46.4093 10C46.4093 7.23858 43.8492 5 40.6912 5C37.5332 5 34.9731 7.23858 34.9731 10C34.9731 12.7614 37.5332 15 40.6912 15Z"
                            fill="#CFA7A5" />
                    </svg>
                    <h1>Elas Inspiram</h1>
                </a>
            </div>
            <h3>Olá, <span id="b_usuario">usuário</span>!</h3>

            <button class="opcaoMural" onclick="abrirEspecificoMenu('muralApoio', this)" id="defaultOpen">Mural de
                Apoio</button>

            <button class="opcaoMural" onclick="abrirEspecificoMenu('causasMural', this)" id="defaultOpen">Apoie
                Causas</button>

            <button class="opcaoMural" onclick="abrirEspecificoMenu('doacoesMural', this)" id="defaultOpen">Minhas
                Doações</button>

            <button id="buttonSair" onclick="SairLogin()">Sair</button>
        </div>
    </div>
    <div class="conteudoMural">
        <div id="muralApoio" class="conteudoOpcaoMural">
            <h1>Mural de apoio</h1>
            <h3>Gostaria de compartilhar algo? Aqui é o seu espaço para isto!</h3>

            <form class="muralPostagens" id="formularioPostagem" method="post" onsubmit="return publicar()">
                <span>Título do depoimento:</span>
                <input name="titulo" id="titulo" maxlength="100" type="text">
                <span>Depoimento:</span>
                <textarea name="descricao" id="textarea_descricao" maxlength="1000" rows="20"></textarea>
                <button>Enviar</button>
            </form>

            <div class="div-results">
                <div id="feed_container" class="feed-container">
                </div>
            </div>
        </div>
    </div>
    <div id="causasMural" class="conteudoOpcaoMural">
        <div class="MuralApoieCausas">
            <h1>Apoie Causas Aqui!</h1>
            <span>Nesta sessão você encontra causas que precisam de você, de apoio, confira as arrecadações e clique
                em
                Realizar
                Doação! </span>
            <div class="HeaderCausas">
                <div class="HeaderCausasSeparação">
                    <img src="../assets/imgs/causa (4).png" alt="">
                    <h5>Capacitando Elas</h5>
                </div>
                <div class="HeaderCausasSeparação">
                    <p>Muitas mulheres enfrentam barreiras financeiras para ingressar em carreiras de tecnologia.
                        Doar
                        para
                        este projeto de estudo, e programa de capacitação, ajuda a fornecer oportunidades
                        educacionais e
                        de
                        desenvolvimento profissional para mulheres que não pussuem incentivos e capital para entrar
                        na
                        área. Isso permite que elas
                        adquiram habilidades necessárias para entrar e avançar na carreira de tecnologia.</p>
                    <button onclick="aparecerPopUpDoacao('Capacitando Elas')">Realizar Doação</button>
                </div>
            </div>
            <div class="HeaderCausas">
                <div class="HeaderCausasSeparação">
                    <img src="../assets/imgs/causa (3).png" alt="">
                    <h5>Bolsas STEM</h5>
                </div>
                <div class="HeaderCausasSeparação">
                    <p>Oferecemos bolsas de estudo específicas para mulheres interessadas em ciência, tecnologia,
                        engenharia e matemática (STEM) é uma forma eficaz de apoiar a participação delas nessas
                        áreas.
                        Essas
                        bolsas ajudam a superar as barreiras financeiras e incentivam as mulheres a buscar carreiras
                        em
                        campos tradicionalmente dominados por homens.</p>
                    <button onclick="aparecerPopUpDoacao('Bolsas STEM')">Realizar Doação</button>
                </div>
            </div>
            <div class="HeaderCausas">
                <div class="HeaderCausasSeparação">
                    <img src="../assets/imgs/causa (2).png" alt="">
                    <h5>Projeto TechWomen</h5>
                </div>
                <div class="HeaderCausasSeparação">
                    <p>Uma iniciativa dedicada a capacitar mulheres e promover a igualdade de gênero no campo da
                        tecnologia. Através de doações e parcerias, o projeto oferece bolsas de estudo, programas de
                        treinamento e mentoria personalizados para mulheres interessadas em se envolver na área. As
                        doações recebidas são direcionadas para a criação de programas educacionais, workshops e
                        eventos
                        que visam encorajar e apoiar o crescimento profissional das mulheres na indústria de
                        tecnologia.
                        Ao contribuir, você está ajudando a construir uma base sólida para que mais mulheres possam
                        explorar seu potencial na área de tecnologia, promovendo uma sociedade mais inclusiva e
                        diversa.
                    </p>
                    <button onclick="aparecerPopUpDoacao('Projeto TechWomen')">Realizar Doação</button>
                </div>
            </div>
            <div class="HeaderCausas">
                <div class="HeaderCausasSeparação">
                    <img src="../assets/imgs/causa (1).png" alt="">
                    <h5>Girls Who Code</h5>
                </div>
                <div class="HeaderCausasSeparação">
                    <p>Um projeto que busca reduzir a lacuna de gênero na indústria da tecnologia, oferecendo
                        oportunidades de aprendizado e desenvolvimento para meninas interessadas em programação e
                        ciências da computação. Nossas alunas além de aprender e se formar gratuitamente conosco,
                        também
                        são direcionadas para vagas em empresas parceiras. Lembrando que nosso processo é
                        completamente
                        gfratuito, então contamos com a sua ajuda para promover o crescimento profissional delas!
                    </p>
                    <button onclick="aparecerPopUpDoacao('Girls Who Code')">Realizar Doação</button>
                </div>
            </div>
        </div>
    </div>
    <div id="doacoesMural" class="conteudoOpcaoMural">
        <h1>Minhas Doações</h1>
        <p>doacoes</p>
        <div class="todosGraficos">
            <div class="graficos">
                <canvas id="myChart"></canvas>
            </div>
            <div class="graficos">
                <canvas id="myChart2"></canvas>
            </div>
            <div class="graficos">
                <canvas id="myChart3"></canvas>
            </div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</html>

<script>
    function abrirEspecificoMenu(nomeOpcaoMenu, elmnt) {
        var i, conteudoOpcaoMural, opcaoMural;

        conteudoOpcaoMural = document.getElementsByClassName("conteudoOpcaoMural");
        for (i = 0; i < conteudoOpcaoMural.length; i++) {
            conteudoOpcaoMural[i].style.display = "none";
        }

        opcaoMural = document.getElementsByClassName("opcaoMural");
        for (i = 0; i < opcaoMural.length; i++) {
            opcaoMural[i].style.backgroundColor = "";
        }

        document.getElementById(nomeOpcaoMenu).style.display = "block";

    }
    document.getElementById("defaultOpen").click();

    function aparecerPopUpDoacao(titulo) {
        var popUp = document.getElementById(`pop-up`);
        tituloPopUp.innerHTML = titulo;
        popUp.style.display = "flex";
        popUp.style.position = "fixed";
    }

    function fecharPopUpDoacao() {
        var popUp = document.getElementById(`pop-up`);
        popUp.style.display = "none";
        escurecer.style.opacity = 1;
    }
    function limparFormulario() {
        document.getElementById("formularioPostagem").reset();
    }
    function publicar() {
        var idUsuario = sessionStorage.ID_USUARIO;
        var nomeUsuario = sessionStorage.NOME_USUARIO;

        var corpo = {
            titulo: formularioPostagem.titulo.value,
            descricao: formularioPostagem.descricao.value
        }

        fetch(`/avisos/publicar/${idUsuario}`, {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(corpo)
        }).then(function (resposta) {
            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert(nomeUsuario + ", Seu post foi realizado com sucesso!");
                window.location = "mural.html";
                limparFormulario();
                atualizarFeed();
                aguardar();
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            aguardar();
        });
        return false;
    }
    function editar(idAviso) {
        sessionStorage.ID_POSTAGEM_EDITANDO = idAviso;
        console.log("cliquei em editar - " + idAviso);
        window.alert("Você será redirecionado à página de edição do aviso de id número: " + idAviso);
        window.location = "edicao-aviso.html"
    }
    function deletar(idAviso) {
        console.log("Criar função de apagar post escolhido - ID" + idAviso);
        fetch(`/avisos/deletar/${idAviso}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {

            if (resposta.ok) {
                window.alert("Post deletado com sucesso pelo usuario de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
                window.location = "mural.html"
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }
    function atualizarFeed() {
        aguardar();
        fetch("/avisos/listar").then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("feed_container");
                    feed.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];
                        // criando e manipulando elementos do HTML via JavaScript
                        var divPublicacao = document.createElement("div");
                        var spanID = document.createElement("span");
                        var spanTitulo = document.createElement("span");
                        var spanNome = document.createElement("span");
                        var divDescricao = document.createElement("div");
                        var divButtons = document.createElement("div");
                        var btnEditar = document.createElement("button");
                        var btnDeletar = document.createElement("button");

                        // spanID.innerHTML = "ID: <b>" + publicacao.idAviso + "</b>";
                        spanNome.innerHTML = publicacao.nomeUsuario + " - ";
                        spanTitulo.innerHTML = publicacao.titulo;
                        divDescricao.innerHTML = "Depoimento: <b>" + publicacao.descricao + "</b>";

                        btnEditar.innerHTML = "Editar";
                        btnDeletar.innerHTML = "Deletar";

                        divPublicacao.className = "publicacao";
                        spanTitulo.id = "inputNumero" + publicacao.idAviso;
                        spanNome.className = "publicacao-nome";
                        spanTitulo.className = "publicacao-titulo";
                        divDescricao.className = "publicacao-descricao";
                        divButtons.className = "div-buttons"
                        btnEditar.className = "publicacao-btn-editar"
                        btnEditar.id = "btnEditar" + publicacao.idAviso;
                        btnEditar.setAttribute("onclick", `editar(${publicacao.idAviso})`);
                        btnDeletar.className = "publicacao-btn-editar"
                        btnDeletar.id = "btnDeletar" + publicacao.idAviso;
                        btnDeletar.setAttribute("onclick", `deletar(${publicacao.idAviso})`);
                        divPublicacao.appendChild(spanID);
                        divPublicacao.appendChild(spanNome);
                        divPublicacao.appendChild(spanTitulo);
                        divPublicacao.appendChild(divDescricao);
                        divPublicacao.appendChild(divButtons);
                        divButtons.appendChild(btnEditar);
                        divButtons.appendChild(btnDeletar);
                        feed.appendChild(divPublicacao);
                    }
                    aguardar();
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            aguardar();
        });
    }
    function testar() {
        aguardar();
        var formulario = new URLSearchParams(new FormData(document.getElementById("form_postagem")));
        var divResultado = document.getElementById("div_feed");
        divResultado.appendChild(document.createTextNode(formulario.get("descricao")));
        divResultado.innerHTML = formulario.get("descricao");
        aguardar();
        return false;
    }
</script>